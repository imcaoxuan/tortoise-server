<!--
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>消息</title>
    <script src="https://code.caoxuan.top/js/jquery-3.5.1.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script>
        $(function () {
            var uuid = $.cookie('uuid');
            var from;
            if ("WebSocket" in window) {
                //alert("您的浏览器支持 WebSocket!");

                // 打开一个 web socket
                var ws = new WebSocket("ws://localhost:8080/echo");

                ws.onopen = function () {
                    // Web Socket 已连接上，使用 send() 方法发送数据
                    alert("已连接服务器")
                    ws.send("{\"type\":0,\"uuid\":\"" + uuid + "\"}");
                };

                ws.onmessage = function (evt) {
                    var received_msg = evt.data;
                    console.log(received_msg);
                    var content = JSON.parse(received_msg)["content"];
                    var p = "<div style='border: 1px black solid; width: 200px; display: block;word-break: break-all;white-space: normal;' >" + "对方：" + content + "</div><br>";
                    $("#display_div").append(p);

                };
                ws.onclose = function (ev) {
                    // 关闭 websocket
                    alert("连接已关闭" + ev.reason)
                };
            } else {
                // 浏览器不支持 WebSocket
                alert("您的浏览器不支持 WebSocket!");
                return;
            }
            $("#send").click(function () {
                var file = $("#file");
                var inputText = $("#inputText");
                var content;
                if (""!==file.val()) {
                    upload();
                    var fileName = getFileName(file.val());
                    content = "<a href='" + "/files/" + fileName + "'>" + fileName + "</a>";
                } else {
                    content = inputText.val();
                }
                inputText.val("");
                var t = "<div style='border: 1px black solid; width: 200px; margin-left: 50%; display: block;word-break: break-all;white-space: normal;'>" + content + "</div><br>"
                $("#display_div").append(t);
                var message = "{\"type\":1,\"from\":\"" + from +"\",\"content\":\""+ content +"\",\"uuid\":\"" + uuid + "\"}";
                ws.send(message);
            });

        });

        /**
         * 改变按钮的状态
         * @param bool == false ? disable
         */
        function change(bool) {
            var upload = $("#upload");
            if (bool) {
                upload.removeAttr("disabled");
            } else {
                upload.attr('disabled',"true")
            }
        }

        function getFileName(o){
            var pos=o.lastIndexOf("\\");
            return o.substring(pos+1);
        }


        function upload() {
            change(false);
            var formData = new FormData($('#form')[0]);
            $.ajax({
                type : 'POST',
                url : '/upload',
                data : formData,
                async: true,
                cache : false,
                processData : false,
                contentType : false,
                success : function (data) {
                    console.log(data)
                },
                error : function () {
                    alert("failed")
                },
                complete : function () {
                    $("#file").val(null);
                    change(true)
                }

            });
        }

    </script>
    <script type="text/javascript">

    </script>
    <style>
        #box {
            width: 480px;
            height: 960px;
            margin: 0 auto;
        }

        #display_div {
            border: black solid 1px;
            width: 480px;
            height: 480px;
            resize: none;
            float: left;
            font-size: 18px;
            overflow-y: auto;
        }

        #in {
            float: left;
            width: 100%;
            position: relative;
        }

        #inputText {
            width: 100%;
            height: 50px;
            font-size: 16px;
            resize: none;
        }

        #send {
            position: absolute;
            top: 50%;
            right: 0;
        }
    </style>
</head>
<body>
<div id="box">
    <div id="display_div"></div>
    <div id="in"><textarea id="inputText"></textarea><input id="send" type="submit" value="发送"></div>
    <form id="form" enctype="multipart/form-data">
        文件：<input type="file" name="file" id="file">
    </form>
</div>
</body>

</html>-->
